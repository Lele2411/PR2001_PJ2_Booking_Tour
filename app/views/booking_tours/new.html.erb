<div class="container">
  <div class="col-md-4 col-lg-6" style="margin: auto;">
    <h3><%= current_user.name %> Please continue complete the form below </h3>
    <% seats = @tour.seats - @tour_detail.booking_tours&.select{|b| b.book?}.sum{|x| x.quantity} %>
    <table class="table table-striped">
      <tr>
        <th>Customer Name</th>
        <td><%= current_user.name %></td>  
      </tr>
      <tr>
        <th>Email</th>
        <td><%= current_user.email %></td> 
      </tr>
      <tr>
        <th>Tour</th>
        <td><%= @tour.name %></td>  
      </tr>
      <tr>
        <th>Departure Time</th>
        <td><%= @tour_detail.departure_time %></td> 
      </tr>
      <tr>
        <th>Return Time</th>
        <td><%= @tour_detail.return_time %></td> 
      </tr>
      <tr>
        <th>Price($)</th>
        <td id="get-price"><%= @tour.price %></td> 
      </tr>
      <tr>
        <th>Coupon(%)</th>
        <td id="get-coupon"><%= @tour.coupon %></td>  
      </tr>
      <tr>
        <th>Available Seat(s)</th>
        <td><%= seats %></td>  
      </tr>
      <tr>
        <th>Quantity</th>
        <td>
          <input type="number" id="quantity" name="quantity" min="1" max="<%= seats %>" value="1" style="width: 100px">
        </td>  
      </tr>
      <tr>
        <th>Tatal($)(included coupon)</th>
        <td><p id="total"><%= @tour.price * (1 - @tour.coupon/100.to_f) %></p></td> 
      </tr>
    </table>

    <%= form_for [@tour,@booking_tour] do |f| %>
      <%= render 'shared/error_messages', object: f.object %>
      <%= f.hidden_field :tour_detail_id, value: @tour_detail.id %>
      <%= f.hidden_field :quantity, value: "1", id: "get-quantity" %>
      <%= f.submit "Booking", class: "btn btn-warning" %>
    <% end %>
  </div>
</div>

<script type="text/javascript">
  const price = $("#get-price").html()
  const coupon = $("#get-coupon").html()
  $("#quantity").change(function(){ 
    var quantity = $("#quantity").val()
    var total = Number(price) * Number(quantity) * (1 - parseFloat(coupon)/100)
    $("#total").html(total)
    $("#get-quantity").val(quantity)
  })
</script>
